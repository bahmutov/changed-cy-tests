name: ci
on: [pull_request]
jobs:
  cypress-run:
    runs-on: ubuntu-latest
    steps:
      # - name: Checkout master ðŸ›Ž
      #   uses: actions/checkout@v2
      #   with:
      #     ref: master

      - name: Checkout current ðŸ›Ž
        uses: actions/checkout@v2

      - name: current commit SHA
        run: |
          git rev-parse HEAD
          # save it to get back in the future
          export MERGE_COMMIT_SHA=$(git rev-parse HEAD)

      - run: git ls-remote
      - run: git fetch --no-tags --depth=1 origin master
      - run: |
          git checkout origin/master
          ls -la .github/workflows

      - run: git fetch --no-tags --depth=1 origin changed-tests
      - run: |
          git checkout origin/changed-tests
          ls -la .github/workflows

      # - run: git branch

      # - run: |
      #     git fetch --no-tags --depth=1 origin master
      #     git checkout -b master
      #     ls -la .github/workflows
      #     git checkout -

      - run: cat .github/workflows/main.yml
      - run: git status
      - name: current commit SHA
        run: git rev-parse HEAD
      - run: echo Merged commit SHA ${{ github.event.pull_request.merge_commit_sha }}
      - run: echo Merged commit SHA 2 ${{ github.event.merge_commit_sha }}

      - run: git checkout ${{ github.event.pull_request.merge_commit_sha }}
      - run: cat .github/workflows/main.yml
      - run: git diff --name-only origin/master origin/changed-tests

      - name: Cypress run ðŸ§ª
        uses: cypress-io/github-action@v1
